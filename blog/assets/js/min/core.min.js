/*RedCodeBlueCode*/function catPopCallbacks(){$(".create-tag").on("click",function(){console.log("event listener fired"),saveCat()}),$(".tag-name").on("click",function(){$(this).hasClass("active-tag")?removeCatFromPost($(this),$("#postid-hidden").text()):addCatToPost($(this),$("#postid-hidden").text())}),$(".dim, #close-tag-pop").on("click",function(){$(".tag-pop-wrap").fadeOut("medium",function(){$(this).remove()})})}function tagPopCallbacks(){$(".create-tag").on("click",function(){saveTag()}),$(".tag-name").on("click",function(){$(this).hasClass("active-tag")?removeTagFromPost($(this),$("#postid-hidden").text()):addTagToPost($(this),$("#postid-hidden").text())}),$(".dim, #close-tag-pop").on("click",function(){$(".tags-pop-wrap").fadeOut("medium",function(){$(this).remove()})})}function imagePopCallbacks(){$("body").addClass("dim-active"),$("#featured-image-form").on("submit",function(a){console.log("featured image form submitted"),a.preventDefault();var b=new FormData(document.getElementById("featured-image-form"));b.append("action",actionUploadFeaturedImage),b.append("postid",getPostId()),uploadFeaturedImage(b)}),$(".dim, #featured-img-dialog-close").on("click",function(){console.log("closing featured img dialog, #featured-img-dialog-close clicked"),$(".featured-image-pop-wrap").fadeOut("medium",function(){$(this).remove()}),$("body").removeClass("dim-active")})}function mainContainerCallbacks(){$(".dim, #message-close").on("click",function(){$(".dim:not([data*=tags])").hide(),$("#message").fadeOut(),$("body").removeClass("dim-active")}),$(".post-edit").on("click",function(){var a=$(this).data("postid");load("start"),$("#main-container").html("").load(homeUrl+"src/editor.php?postid="+a,function(){editContainerCallbacks(),load("stop")})})}function editContainerCallbacks(){$(".save-post").on("click",function(){console.log("Attempting to save post"),validatePost()&&(data={draft:!1},savePost(data))}),$(".save-draft").on("click",function(){console.log("Attempting to save post as draft"),validatePost()&&(data={draft:!0},savePost(data))}),$(".unpublish-post").on("click",function(){console.log("Attempting to unpublish post");var a=getPostId();data={draft:!0,postid:a},updateDraftStatus(data)}),$(".manage-tags").on("click",function(){var a=$("#postid-hidden").text(),b=document.createElement("div"),c=homeUrl+"src/tags.php?postid="+a;console.log(c),b=$(b),$(b).load(c,function(){$("body").append($(b)),$(".dim").show().data("lock","tags"),tagPopCallbacks()})}),$(".manage-cats").on("click",function(){var a=$("#postid-hidden").text(),b=document.createElement("div"),c=homeUrl+"src/categories.php?postid="+a;console.log(c),b=$(b),$(b).load(c,function(){$("body").append($(b)),$(".dim").show().data("lock","tags"),catPopCallbacks()})}),$("#post-title").on("keyup",function(a){var b=$(this).val();b=formatPermalink(b),$("#post-permalink-input").val(b)}),$("#post-permalink-input").on("keyup",function(a){var b=$(this).val();b=formatPermalink(b),$(this).val(b)}),$(".permalink-change").on("click",function(){if($(this).parent().toggleClass("disabled"),$(this).parent().hasClass("disabled")){console.log("Attempting to update permalink");var a=$(this).parent().find("input").val();a=formatPermalink(a);var b=getPostId();data={permalink:a,postid:b},updatePermalink(data)}}),$(".feature-image-tool").on("click",function(){var a=$("#postid-hidden").text(),b=document.createElement("div"),c=homeUrl+"src/featuredimage.php?postid="+a;console.log(c),b=$(b),$(b).load(c,function(){$("body").append(b),$("body").addClass("dim-active"),imagePopCallbacks()})}),initEditor(),initImages(),imgEditorCallbacks()}function addTagToPost(a,b){a.toggleClass("active-tag");var c=a.data("tagid");console.log("adding tag "+a.data("tagid")+" to post "+b),$.post(window.location.href,{async:!0,action:actionAddTagToPost,tagid:c,postid:b,async:!0},function(a){console.log(a)})}function removeTagFromPost(a,b){a.toggleClass("active-tag");var c=a.data("tagid");console.log("removing tag "+a.data("tagid")+" from post "+b),$.post(window.location.href,{async:!0,action:actionRemoveTagFromPost,tagid:c,postid:b},function(a){console.log(a)})}function addCatToPost(a,b){$(".tag-name").removeClass("active-tag"),a.addClass("active-tag");var c=a.data("catid");console.log("adding tag "+a.data("catid")+" to post "+b),$.post(window.location.href,{async:!0,action:actionAddCatToPost,catid:c,postid:b},function(a){console.log(a)})}function removeCatFromPost(a,b){$(".tag-name").removeClass("active-tag");var c=a.data("catid");console.log("removing tag "+a.data("catid")+" from post "+b),$.post(window.location.href,{async:!0,action:actionRemoveCatFromPost,catid:c,postid:b},function(a){console.log(a)})}function saveTag(){var a=$("#tag-create-input").val(),b=$("#postid-hidden").text();console.log(a),$.post(window.location.href,{async:!0,action:actionSaveTag,name:a,postid:b},function(a){console.log("callback"),a=JSON.parse(a),console.log(a);var b=new CustomEvent("tag_saved",{detail:a});document.dispatchEvent(b),console.log("after dispatching event")})}function saveCat(){console.log("event function fired");var a=$("#tag-create-input").val(),b=$("#postid-hidden").text();console.log(a),$.post(window.location.href,{async:!0,action:actionSaveCat,name:a,postid:b},function(a){console.log("callback"),a=JSON.parse(a),console.log(a);var b=new CustomEvent("cat_saved",{detail:a});document.dispatchEvent(b),console.log("after dispatching event")})}function savePost(a){var b=$("#content").html(),c=$("#post-title").val(),d=a.draft,e=$("#postid-hidden").text(),f="1"===$("#is-draft-hidden").text(),g=$("#post-permalink-input").val();console.log("postid: "+e),console.log("wasDraft: "+f),$.post(window.location.href,{async:!0,action:actionSavePost,name:c,file:b,draft:d,wasdraft:f,postid:e,permalink:g},function(a){console.log(a),a=JSON.parse(a),console.log(a);var b="true"==a.draft?1:0;$("#postid-hidden").text(a.postid),$("#is-draft-hidden").text(b);var c=new Event("post_saved");document.dispatchEvent(c)})}function updatePermalink(a){var b=a.permalink,c=a.postid;$.post(window.location.href,{async:!0,action:actionPostPermalink,permalink:b,postid:c},function(a){console.log(a),a=JSON.parse(a);var b=new CustomEvent("permalink_changed",{detail:a});document.dispatchEvent(b)})}function updateDraftStatus(a){var b=a.draft;console.log(a.draft);var c=a.postid;$.post(window.location.href,{async:!0,action:actionPostDraftStatus,draft:b,postid:c},function(a){console.log(a),a=JSON.parse(a);var b="true"==a.draft?1:0;$("#postid-hidden").text(a.postid),$("#is-draft-hidden").text(b);var c=new CustomEvent("draft_status_changed",{detail:a});document.dispatchEvent(c)})}function uploadImage(a){({action:actionUploadImage,imgdata:a});$.ajax({url:window.location.href,type:"POST",processData:!1,contentType:!1,data:a}).done(function(a){console.log(a);var b=JSON.parse(a);if(console.log(b),b.success){var c=new CustomEvent("image_uploaded",{detail:b});document.dispatchEvent(c)}else alert(b.message)})}function uploadFeaturedImage(a){var b={action:actionUploadFeaturedImage,imgdata:a};console.log(b),$.ajax({url:window.location.href,type:"POST",processData:!1,contentType:!1,data:a}).done(function(a){console.log(a);var b=JSON.parse(a);if(console.log(b),b.success){var c=new CustomEvent("featured_image_uploaded",{detail:b});document.dispatchEvent(c)}else alert(b.message)})}function createMessage(a){$("#message-message").html(a),$(".dim").show(),$("#message").fadeIn()}function validatePost(){var a=$("#post-title").val();return""!=a||(createMessage("Your post needs a title."),!1)}function load(a){switch(a){case"start":$(".dim").show(),$(".loading").show();break;case"stop":$(".dim").hide(),$(".loading").hide()}}function getPostId(){return $("#postid-hidden").text()}function initEditor(){$("#italic").on("click",function(){document.execCommand("italic")}),$("#bold").on("click",function(){document.execCommand("bold")}),$("#underline").on("click",function(){document.execCommand("underline")}),$("#strike").on("click",function(){document.execCommand("strikeThrough")}),$("#left").on("click",function(){document.execCommand("justifyLeft")}),$("#center").on("click",function(){document.execCommand("justifyCenter")}),$("#right").on("click",function(){document.execCommand("justifyRight")}),$("#justify").on("click",function(){document.execCommand("justifyFull")}),$("#undo").on("click",function(){document.execCommand("undo")}),$("#redo").on("click",function(){document.execCommand("redo")}),$("#header").on("click",function(){document.execCommand("formatBlock",!1,"H2")}),$("#show-colors-modal").on("click",function(){$("#colors-modal").css("display","inline-block")}),$(".color-choose").on("click",function(){console.log("stuff is happen");var a=document.getSelection();console.log("selection"+a);var b=$(this).data("r"),c=$(this).data("g"),d=$(this).data("b"),e="rgb("+b+", "+c+", "+d+")";document.execCommand("foreColor",!1,e)}),$("#link").on("click",function(){var a=document.getSelection();if(""!=a){var b="";a.anchorNode.parentNode&&a.anchorNode.parentNode.href&&(b=a.anchorNode.parentNode.href);var c=prompt("Enter the link address",b);null!=c&&(c.includes("http://")||c.includes("https://")||(c="http://"+c),document.execCommand("createLink",!1,c))}}),$("#unlink").on("click",function(){document.execCommand("unlink")}),$("#ol").on("click",function(){document.execCommand("insertOrderedList")}),$("#ul").on("click",function(){document.execCommand("insertUnorderedList")}),$("#image").on("click",function(){$("#img-dialog").attr("data-mode","img"),document.getElementById("img-dialog").showModal()}),$("#image-form").on("submit",function(a){console.log("image form submitted"),a.preventDefault();var b=new FormData(document.getElementById("image-form"));b.append("action",actionUploadImage),uploadImage(b)}),$(".feature-image-tool").on("click",function(){})}function insertImage(a){document.execCommand("insertImage",!1,a)&&$("#content").find("img").each(function(){if(!$(this).hasClass("edit-img")){var a=(new Date).getTime(),b="edit-img"+a;wrapImage($(this),a),attachImageEditor($(this),a),$(this).addClass("edit-img").addClass(b).on("click",function(){}),imgEditorCallbacks()}})}function initImages(){console.log("init images"),$(".edit-img").on("click",function(){$(this).parent().find(".img-editor-bar").css("display","flex")})}function wrapImage(a,b){a.wrap('<div class="inline img-editor-wrap img-editor-wrap'+b+'"></div>').on("click",function(){$(this).parent().find(".img-editor-bar").css("display","flex")})}function attachImageEditor(a,b){a.after("<div class='img-editor-bar flex flex-hor container'><div data-imgwrap='.img-editor-wrap"+b+"' data-imgtarget='.edit-img"+b+"' class='img-editor-group flex flex-hor'><button type='button' class='btn img-small'><i class='fa fa-picture-o' aria-hidden='true'></i></button><button type='button' class='btn img-medium'><i class='fa fa-picture-o' aria-hidden='true'></i></button><button type='button' class='btn img-large'><i class='fa fa-picture-o' aria-hidden='true'></i></button><button type='button' class='btn img-full'><i class='fa fa-arrows-h' aria-hidden='true'></i></button></div><div data-imgwrap='.img-editor-wrap"+b+"' data-imgtarget='.edit-img"+b+"' class='img-editor-group flex flex-hor'><button class='btn img-left'>"+iconLeftJustify+"</button><button class='btn img-center'>"+iconCenterJustify+"</button><button class='btn img-right'>"+iconRightJustify+"</button></div><div data-imgwrap='.img-editor-wrap"+b+"' data-imgtarget='.edit-img"+b+"' class='img-editor-group flex flex-hor'><button class='btn img-remove'>"+iconRemove+"</button><button class='btn img-close'>"+iconClose+"</button></div></div>")}function imgEditorCallbacks(){function a(a){return $(a.parent().data("imgwrap"))}function b(a){return a.parent().parent()}$(".img-small").on("click",function(){$($(this).parent().data("imgwrap")).css("width","40%")}),$(".img-medium").on("click",function(){$($(this).parent().data("imgwrap")).css("width","60%")}),$(".img-large").on("click",function(){$($(this).parent().data("imgwrap")).css("width","80%")}),$(".img-full").on("click",function(){$($(this).parent().data("imgwrap")).css("width","100%")}),$(".img-left").on("click",function(){$($(this).parent().data("imgwrap")).css({float:"left",display:"inline-block"})}),$(".img-center").on("click",function(){$($(this).parent().data("imgwrap")).css({float:"none",margin:"auto",display:"block"})}),$(".img-right").on("click",function(){a($(this)).css({float:"right",display:"inline-block"})}),$(".img-remove").on("click",function(){confirm("Are you sure you want to remove this image?")&&a($(this)).remove()}),$(".img-close").on("click",function(){b($(this)).fadeOut()})}function formatPermalink(a){return a=a.replace(/ /g,"-"),a=a.replace(/[+=\[\]{}|\\\/<>;:'"\?!,.&^%\$@\(\)\*\&]/g,""),a=a.toLowerCase()}function editPage(){$("div").attr("contenteditable","true"),$("body").on("click","a",function(a){a.preventDefault(),a.stopPropagation()})}var WELCOME=1,EDITOR=2,postid,iconLeftJustify='<i class="fa fa-align-left" aria-hidden="true"></i>',iconCenterJustify='<i class="fa fa-align-center" aria-hidden="true"></i>',iconRightJustify='<i class="fa fa-align-right" aria-hidden="true"></i>',iconRemove='<i class="fa fa-trash" aria-hidden="true"></i>',iconClose='<i class="fa fa-window-close-o" aria-hidden="true"></i>',ChangeCatcher=function(a){var b=!1,c=window,d=this;a(document).on("focus click",".change-watch",function(){console.log("focus or click on .change-watch element"),d._unsavedChanges=!0,e()}),a(document).on("click",".change-reset",function(){console.log("click on .change-reset element"),d._unsavedChanges=!1,f()});var e=function(){console.log("Unsaved changes"),c.onbeforeunload=function(){return"There are unsaved changes. Are you sure you want to leave?"}},f=function(){console.log("Resetting changes. No unsaved changes"),c.onbeforeunload=null};return{get unsavedChanges(){return b},set unsavedChanges(a){"boolean"==typeof a?(b=a,1==b?e():f()):console.error("invalid parameter passed. boolean expected, received "+typeof a)},reset:function(){b=!1}}},changeCatcher=new ChangeCatcher(jQuery),BobBlog=function(){var a=0;return{get state(){return a}}};$(document).ready(function(){$("#main-container").html("").load(homeUrl+"src/welcome.php",function(){mainContainerCallbacks()}),$(".home-button").on("click",function(){$("#main-container").html("").load(homeUrl+"src/welcome.php",function(){mainContainerCallbacks()})}),$(".new-post").on("click",function(){load("start"),$("#main-container").html("").load(homeUrl+"src/editor.php",function(){load("stop"),editContainerCallbacks()})}),$(".post-edit").on("click",function(){var a=$(this).data("postid");load("start"),$("#main-container").html("").load(homeUrl+"src/editor.php?postid="+a,function(){editContainerCallbacks(),load("stop")})})});var data;document.addEventListener("featured_image_uploaded",function(a){console.log(a.detail);var b=a.detail;$(".featured-image-pop-wrap").remove(),createMessage('Your image "'+b.original_name+"\" is uploaded and saved as this post's featured image!");var c,d=$("#template-featured-image").html();c=templator.processTemplate(d,b),$(".feature-image-tool").html(c)}),document.addEventListener("image_uploaded",function(a){console.log(a.detail);var b=a.detail;document.getElementById("img-dialog").close(),insertImage(b.img_url)}),document.addEventListener("post_saved",function(a){createMessage("Your post is safe!")},!1),document.addEventListener("draft_status_changed",function(a){var b=a.detail;b.draft?(createMessage("This post is now a draft and not visible to the public."),$("body").addClass("")):createMessage("Your post is published and visible to the public!")},!1),document.addEventListener("tag_saved",function(a){console.log(a.detail);var b=a.detail;createMessage('New tag "'+b.tag_name+'" created!');var c=document.createElement("div"),d=document.createElement("div");c=$(c),d=$(d),c.addClass("tag-name").addClass("active-tag").data("tagid",b.tag_id).text(b.tag_name).appendTo("#active-tags"),d.addClass("tag-id").text(b.tag_id).appendTo(c)},!1),document.addEventListener("cat_saved",function(a){console.log(a.detail);var b=a.detail;createMessage('New category "'+b.cat_name+'" created!');var c=document.createElement("div"),d=document.createElement("div");c=$(c),d=$(d),c.addClass("tag-name").addClass("active-tag").data("catid",b.cat_id).text(b.cat_name).appendTo("#active-tags"),d.addClass("tag-id").text(b.cat_id).appendTo(c)},!1),document.addEventListener("permalink_changed",function(a){console.log(a.detail);var b=a.detail;createMessage("This post's url is now \""+homeUrl+b.permalink+".")},!1),document.addEventListener("context_changed",function(){changeCatcher.reset()});var Templator=function(){var a=/{{[\w]+}}/g;this.processTemplate=function(b,c){console.log("debug html, data: "),console.log(b),console.log(c);for(var d,e=b.match(a),f=0;f<e.length;f++)d=e[f].replace("{{","").replace("}}",""),b=c[d]?b.replace(e[f],c[d]):b.replace(e[f],"");return b}},templator=new Templator;